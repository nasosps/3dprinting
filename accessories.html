<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <title>Extras</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen p-4">
    <div class="max-w-3xl mx-auto">
        <div class="flex items-center gap-4 mb-6"><a href="index.html" class="bg-gray-800 w-10 h-10 rounded-full flex items-center justify-center hover:bg-gray-700"><i class="fas fa-arrow-left"></i></a><h1 class="text-2xl font-bold text-indigo-400">Extras</h1></div>

        <div class="bg-gray-800 p-5 rounded-xl border border-gray-700 mb-6 flex gap-3">
            <input type="hidden" id="editId">
            <input type="text" id="aName" placeholder="Περιγραφή" class="flex-grow p-2 rounded bg-gray-900 border border-gray-600 text-white focus:border-indigo-500 outline-none">
            <input type="number" id="aCost" placeholder="Cost €" class="w-24 p-2 rounded bg-gray-900 border border-gray-600 text-white text-center focus:border-indigo-500 outline-none">
            <input type="number" id="aStock" placeholder="Stock" class="w-20 p-2 rounded bg-gray-900 border border-gray-600 text-white text-center focus:border-indigo-500 outline-none">
            <button id="saveBtn" onclick="saveAcc()" class="bg-indigo-600 px-4 rounded font-bold hover:bg-indigo-500 transition"><i class="fas fa-save"></i></button>
            <button id="cancelBtn" onclick="resetForm()" class="bg-gray-600 px-3 rounded hidden hover:bg-gray-500"><i class="fas fa-times"></i></button>
        </div>

        <div id="list" class="space-y-2">Loading...</div>
    </div>

    <script src="common.js"></script>
    <script>
        setTimeout(() => {
            db.collection('accessories').orderBy('name').onSnapshot(snap => {
                const l = document.getElementById('list'); l.innerHTML = "";
                snap.forEach(d => {
                    const a = d.data();
                    l.innerHTML += `
                    <div class="bg-[#27272a] p-3 rounded border border-gray-700 flex justify-between items-center group">
                        <div><span class="font-bold block">${a.name}</span><span class="text-xs text-gray-400">Cost: ${a.cost}€ | Stock: ${a.stock||0}</span></div>
                        <div class="flex gap-2 opacity-0 group-hover:opacity-100 transition">
                            <button onclick="editMode('${d.id}', '${a.name}', ${a.cost}, ${a.stock})" class="text-indigo-400 hover:text-white"><i class="fas fa-pen"></i></button>
                            <button onclick="deleteDoc('accessories','${d.id}')" class="text-red-500 hover:text-white"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>`;
                });
            });
        }, 1000);

        function editMode(id, n, c, s) {
            document.getElementById('editId').value=id; document.getElementById('aName').value=n;
            document.getElementById('aCost').value=c; document.getElementById('aStock').value=s;
            const btn = document.getElementById('saveBtn'); btn.innerHTML = "<i class='fas fa-check'></i>";
            btn.classList.remove('bg-indigo-600'); btn.classList.add('bg-green-600', 'hover:bg-green-500');
            document.getElementById('cancelBtn').classList.remove('hidden');
        }
        function resetForm(){
            document.getElementById('editId').value=""; document.getElementById('aName').value="";
            document.getElementById('aCost').value=""; document.getElementById('aStock').value="";
            const btn = document.getElementById('saveBtn'); btn.innerHTML = "<i class='fas fa-save'></i>";
            btn.classList.remove('bg-green-600', 'hover:bg-green-500'); btn.classList.add('bg-indigo-600');
            document.getElementById('cancelBtn').classList.add('hidden');
        }
        function saveAcc() {
            const id=document.getElementById('editId').value; const n=document.getElementById('aName').value;
            const c=parseFloat(document.getElementById('aCost').value); const s=parseFloat(document.getElementById('aStock').value)||0;
            if(n) {
                const data = {name:n, cost:c, stock:s};
                const action = id ? db.collection('accessories').doc(id).update(data) : db.collection('accessories').add(data);
                action.then(()=>{ resetForm(); });
            }
        }
    </script>
</body>
</html>