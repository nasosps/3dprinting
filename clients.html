<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <title>Πελάτες</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen p-4">
    <div class="max-w-3xl mx-auto">
        <div class="flex items-center gap-4 mb-6"><a href="index.html" class="bg-gray-800 w-10 h-10 rounded-full flex items-center justify-center hover:bg-gray-700"><i class="fas fa-arrow-left"></i></a><h1 class="text-2xl font-bold text-blue-400">Πελατολόγιο</h1></div>

        <div class="bg-gray-800 p-5 rounded-xl border border-gray-700 mb-6 flex gap-3">
            <input type="hidden" id="editId"> <input type="text" id="cName" placeholder="Όνομα Πελάτη" class="flex-grow p-2 rounded bg-gray-900 border border-gray-600 text-white focus:border-blue-500 outline-none">
            <input type="text" id="cPhone" placeholder="Τηλέφωνο" class="flex-grow p-2 rounded bg-gray-900 border border-gray-600 text-white focus:border-blue-500 outline-none">
            <button id="saveBtn" onclick="saveClient()" class="bg-blue-600 px-4 rounded font-bold hover:bg-blue-500 transition">ΠΡΟΣΘΗΚΗ</button>
            <button id="cancelBtn" onclick="resetForm()" class="bg-gray-600 px-3 rounded hidden hover:bg-gray-500"><i class="fas fa-times"></i></button>
        </div>

        <div id="clientsList" class="space-y-2"><div class="text-center text-gray-500">Φόρτωση...</div></div>
    </div>

    <script src="common.js"></script>
    <script>
        setTimeout(() => {
            db.collection('customers').orderBy('createdAt', 'desc').onSnapshot(snap => {
                const div = document.getElementById('clientsList'); div.innerHTML = "";
                snap.forEach(doc => {
                    const c = doc.data();
                    // Προσθέσαμε το κουμπί Edit που καλεί την editMode()
                    div.innerHTML += `
                        <div class="bg-[#27272a] p-4 rounded-xl border border-gray-700 flex justify-between items-center group">
                            <div><h4 class="font-bold text-lg">${c.name}</h4><div class="text-sm text-gray-400"><i class="fas fa-phone mr-1"></i> ${c.phone || '-'}</div></div>
                            <div class="flex gap-2 opacity-0 group-hover:opacity-100 transition">
                                <button onclick="editMode('${doc.id}', '${c.name}', '${c.phone}')" class="text-blue-400 hover:text-white p-2"><i class="fas fa-pen"></i></button>
                                <button onclick="deleteDoc('customers', '${doc.id}')" class="text-red-500 hover:text-white p-2"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>`;
                });
            });
        }, 1000);

        // Ενεργοποίηση Mode Επεξεργασίας
        function editMode(id, name, phone) {
            document.getElementById('editId').value = id;
            document.getElementById('cName').value = name;
            document.getElementById('cPhone').value = phone;
            
            const btn = document.getElementById('saveBtn');
            btn.innerText = "ΕΝΗΜΕΡΩΣΗ";
            btn.classList.remove('bg-blue-600'); btn.classList.add('bg-green-600', 'hover:bg-green-500');
            document.getElementById('cancelBtn').classList.remove('hidden');
            document.getElementById('cName').focus();
        }

        function resetForm() {
            document.getElementById('editId').value = "";
            document.getElementById('cName').value = "";
            document.getElementById('cPhone').value = "";
            
            const btn = document.getElementById('saveBtn');
            btn.innerText = "ΠΡΟΣΘΗΚΗ";
            btn.classList.remove('bg-green-600', 'hover:bg-green-500'); btn.classList.add('bg-blue-600');
            document.getElementById('cancelBtn').classList.add('hidden');
        }

        function saveClient() {
            const id = document.getElementById('editId').value;
            const name = document.getElementById('cName').value;
            const phone = document.getElementById('cPhone').value;
            if(!name) return alert("Βάλε όνομα!");

            const data = { name: name, phone: phone };

            // Αν υπάρχει ID κάνουμε Update, αλλιώς Add
            const action = id ? db.collection('customers').doc(id).update(data) : db.collection('customers').add({ ...data, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
            
            action.then(() => { resetForm(); alert(id ? "Ενημερώθηκε!" : "Προστέθηκε!"); });
        }
    </script>
</body>
</html>